name: Release

on:
  push:
    tags:
      - 'v*.*.*'

permissions:
  contents: write

jobs:
  build:
    runs-on: windows-2025-vs2026
    steps:
      - uses: actions/checkout@v4

      - name: Setup MSBuild
        uses: microsoft/setup-msbuild@v2

      - name: Build Release
        run: msbuild src\ClipPing.sln /p:Configuration=Release /p:Platform=x64

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          files: src\ClipPing\x64\Release\ClipPing.exe
          generate_release_notes: true

  # Uncomment after your first WinGet submission is merged.
  # Requires a WINGET_PAT repository secret (classic PAT with public_repo scope).
  #
  # winget:
  #   needs: build
  #   runs-on: windows-latest
  #   steps:
  #     - name: Extract version from tag
  #       id: version
  #       shell: bash
  #       run: echo "version=${GITHUB_REF_NAME#v}" >> "$GITHUB_OUTPUT"
  #
  #     - name: Download wingetcreate
  #       shell: pwsh
  #       run: |
  #         Invoke-WebRequest -Uri https://aka.ms/wingetcreate/latest -OutFile wingetcreate.exe
  #
  #     - name: Update WinGet package
  #       shell: pwsh
  #       run: |
  #         $url = "https://github.com/kevingosse/ClipPing/releases/download/${{ github.ref_name }}/ClipPing.exe"
  #         .\wingetcreate.exe update KevinGosse.ClipPing `
  #           --version ${{ steps.version.outputs.version }} `
  #           --urls $url `
  #           --submit `
  #           --token ${{ secrets.WINGET_PAT }}
